# .github/workflows/preview.yml
name: Deploy PR previews

on:
    pull_request:
        types:
            - opened
            - reopened
            - synchronize
            - closed

concurrency: preview-${{ github.ref }}

jobs:
    deploy-preview:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Install and Build
              if: github.event.action != 'closed'
              run: |
                  npm install
                  npm run build

            - name: Deploy PR preview
              id: preview
              uses: rossjrw/pr-preview-action@v1
              with:
                source-dir: ./
                preview-branch: gh-pages
                action: auto
                qr-code: true

            - name: Comment Preview URL
              if: ${{ steps.preview.outputs.preview-url }}
              uses: actions/github-script@v7
              with:
                script: |
                  const url = `${{ steps.preview.outputs.preview-url }}`;
                  const body = `ðŸš€ PR Preview is ready: ${url}`;
                  await github.rest.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: context.issue.number,
                    body
                  });